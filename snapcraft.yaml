name: thonny
base: core18
adopt-info: thonny
grade: stable
confinement: strict
compression: lzo
source-code: https://git.launchpad.net/thonny-snap/tree/snapcraft.yaml?h=bionic
license: MIT
issues:
  - https://bugs.launchpad.net/thonny-snap
  - https://github.com/sameersharma2006/thonny-snap/issues
architectures:
  - build-on: amd64

slots:
  thonny:
    interface: dbus
    bus: session
    name: org.thonny.Thonny

apps:
  thonny:
    command: bin/thonny
    extensions: [gnome-3-34]
    common-id: org.thonny.Thonny
    environment:
      THONNY_USER_DIR: $SNAP_USER_DATA
      TMPDIR: $XDG_RUNTIME_DIR
      DISABLE_WAYLAND: 1
    plugs:
      - home
      - unity7
      - network
      - network-bind
      - network-status
      - audio-playback
      - audio-record
      - bluez
      - camera
      - hardware-observe
      - system-observe
      - upower-observe
      - optical-drive
      - raw-usb
      - udisks2
      - removable-media
      - screen-inhibit-control
    desktop: packaging/linux/org.thonny.Thonny.desktop

parts:
  thonny:
    source: https://github.com/thonny/thonny.git
    parse-info: [packaging/linux/org.thonny.Thonny.appdata.xml]
    plugin: dump
    build-packages:
      - wget
    override-pull: |
      snapcraftctl pull
      #VER="$(git describe --tags --abbrev=0 | cut -c 2-)"
      #wget -q -O- https://github.com/thonny/thonny/releases/download/v${VER}/thonny-${VER}-x86_64.tar.gz |\
      wget -q -O- https://github.com/thonny/thonny/releases/download/v4.1.6/thonny-4.1.7-x86_64.tar.gz |\
           tar xzf - --strip-components=1 -C $SNAPCRAFT_PART_SRC
    override-prime: |
      snapcraftctl prime
      sed -e 's|Icon=thonny|Icon=${SNAP}/packaging/icons/thonny-256x256.png|' -i packaging/linux/org.thonny.Thonny.desktop
    prime:
      - bin
      - lib
      - packaging/linux/org.thonny.Thonny*
      - packaging/icons/thonny-256x256.png
      - -packaging/linux/org.thonny.Thonny.Devel.yaml

  xclip:
    after: [thonny]
    source: https://github.com/astrand/xclip.git
    source-tag: '0.13'
    plugin: autotools
    configflags:
      - --prefix=/usr
    build-packages:
      - libxmu-dev
      - libxmu-headers
    stage-packages:
      - libxmu6
      - libxt6
    prime:
      - usr/bin
      - usr/lib/*/libXt.so*
      - usr/lib/*/libXmu.so*

  deps:
    after: [xclip]
    plugin: nil
    stage-packages:
      - libnotify-bin
      - zenity
    prime:
      - usr/bin/zenity
      - usr/bin/gdialog
      - usr/bin/notify-send
      - usr/share/zenity
